{% extends 'base.html' %}}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% bootstrap_messages %}

{% block content %}
<div>
    {% if latest_question_list %}
    <ul>
        {% for question in latest_question_list %}
        <li><a href="{% url 'polls:detail' question.id %}">{{ question.question_text }}</a></li>
        <h1>{{ question.question_text }}</h1>
        <ul>
            {% for choice in question.choice_set.all %}
                <li>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}</li>
            {% endfor %}
        </ul>
        {% endfor %}
    </ul>
    {% else %}
        <p>No polls are available.</p>
    {% endif %}
</div>

<div>
    <div id="chartContainer" style="height: 450px; width: 100%;"></div>
    <script type="text/javascript">
    window.onload = function () {
      var dataPoints1 = [], dataPoints2 = [], dataPoints3 = [];
      var stockChart = new CanvasJS.StockChart("chartContainer",{
        exportEnabled: true,
        theme: "dark2",
        title:{
          text:"StockChart with Tooltip & Crosshair Syncing"
        },
        charts: [{
          toolTip: {
            shared: true
          },
          axisX: {
            lineThickness: 5,
            tickLength: 0,
            labelFormatter: function(e) {
              return "";
            },
            crosshair: {
              enabled: true,
              snapToDataPoint: true,
              labelFormatter: function(e) {
                return ""
              }
            }
          },
          axisY2: {
            title: "Bitcoin Price",
            prefix: "$"
          },
          legend: {
            verticalAlign: "top",
            horizontalAlign: "left"
          },
          data: [{
            name: "Price (in USD)",
            yValueFormatString: "$#,###.##",
            axisYType: "secondary",
            type: "candlestick",
            risingColor: "green",
            fallingColor: "red",
            dataPoints : dataPoints1
          }]
        },{
          height: 100,
          toolTip: {
            shared: true
          },
          axisX: {
            crosshair: {
              enabled: true,
              snapToDataPoint: true
            }
          },
          axisY2: {
            prefix: "$",
            title: "BTC/USD"
          },
          legend: {
            horizontalAlign: "left"
          },
          data: [{
            yValueFormatString: "$#,###.##",
            axisYType: "secondary",
            name: "BTC/USD",
            dataPoints : dataPoints2
          }]
        }],
        navigator: {
          data: [{
            color: "grey",
            dataPoints: dataPoints3
          }],
          slider: {
            minimum: new Date(2023, 09, 01),
            maximum: new Date(2023, 12, 01)
          }
        }
      });
      $.get('{% url "polls:line_chart_json2" %}', function(data) {
        for(var i = 0; i < data.length; i++){
          dataPoints1.push({x: new Date(data[i].date), y: [Number(data[i].open), Number(data[i].high), Number(data[i].low), Number(data[i].close)], color: data[i].open < data[i].close ? "green" : "red"});;
          dataPoints2.push({x: new Date(data[i].date), y: Number(data[i].volume), color: data[i].open < data[i].close ? "green" : "red"});
          dataPoints3.push({x: new Date(data[i].date), y: Number(data[i].close)});
        }
        stockChart.render();
      });
    }
    </script>
</div>

{% endblock %}